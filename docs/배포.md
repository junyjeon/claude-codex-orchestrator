# 배포

## 사전 준비

### Codex CLI 설치 및 로그인

먼저 Codex CLI를 설치하고 인증한다.

```bash
# Codex CLI 설치 (방법은 공식 문서 참조)
npm install -g @openai/codex
# 또는
brew install --cask codex

# 브라우저 인증
codex

# 또는 API 키로 로그인
printenv OPENAI_API_KEY | codex login --with-api-key
```

인증이 완료되면 `codex "test prompt"` 명령이 작동해야 한다.

## 설치

### npm 패키지 (권장)

```bash
npm install -g @junyjeon/claude-codex-orchestrator
```

### 로컬 개발

```bash
git clone https://github.com/junyjeon/claude-codex-orchestrator.git
cd claude-codex-orchestrator
npm install
npm run build
npm link
```

## Claude Code 연결

### 1. MCP 서버 등록

`~/.claude.json` 파일에 추가:

```json
{
  "mcpServers": {
    "codex": {
      "type": "stdio",
      "command": "npx",
      "args": ["-y", "@junyjeon/claude-codex-orchestrator"]
    }
  }
}
```

로컬 개발인 경우:

```json
{
  "mcpServers": {
    "codex": {
      "type": "stdio",
      "command": "node",
      "args": ["/home/jun/11_November/claude-codex-orchestrator/dist/index.js"]
    }
  }
}
```

### 2. 환경 변수 (선택)

로그 레벨이나 타임아웃을 변경하려면 `.env` 파일을 만든다.

```bash
# 로그 레벨 (기본: info)
LOG_LEVEL=debug

# Codex CLI 타임아웃 (기본: 30000ms)
CODEX_TIMEOUT=60000
```

### 3. 활성화 (필요한 경우)

일부 환경에서는 `~/.claude/settings.json`에서 활성화가 필요하다.

```json
{
  "enabledMcpjsonServers": [
    "codex"
  ]
}
```

## 테스트

Claude Code에서 간단한 요청을 해본다.

```
"binary search 함수를 TypeScript로 구현해줘"
```

성공하면:
- Codex가 코드를 생성함
- Claude가 코드를 검증하고 제시함

## 문제 해결

### Codex CLI not found

MCP 서버가 에러를 반환한다:
```
Codex CLI not found. Please install...
```

해결:
1. Codex CLI를 설치한다
2. PATH에 codex가 있는지 확인: `which codex`
3. Claude Code를 재시작한다

### Authentication failed

```
Codex authentication failed. Please run: codex login
```

해결:
1. 터미널에서 `codex` 또는 `codex login` 실행
2. 브라우저에서 인증
3. Claude Code를 재시작한다

### Timeout

```
Codex CLI timeout after 30000ms
```

해결:
1. `.env`에서 CODEX_TIMEOUT을 늘린다
2. 네트워크 연결 확인
3. 더 간단한 요청으로 테스트

### MCP 서버가 감지되지 않음

Claude Code에서 도구 목록에 generate_code가 없음

해결:
1. `~/.claude.json` 설정 확인
2. Claude Code 완전히 재시작
3. 수동 테스트:
```bash
npx @junyjeon/claude-codex-orchestrator
# 또는
node /path/to/dist/index.js
```

## 업데이트

```bash
# npm 패키지
npm update -g @junyjeon/claude-codex-orchestrator

# 로컬 개발
cd claude-codex-orchestrator
git pull
npm install
npm run build
```

## 제거

```bash
# npm 패키지
npm uninstall -g @junyjeon/claude-codex-orchestrator

# Claude Code 설정에서 제거
# ~/.claude.json에서 codex 섹션 삭제
```
