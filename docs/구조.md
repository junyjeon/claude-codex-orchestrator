# 구조

```
claude-codex-orchestrator/
├── src/
│   ├── index.ts       # CLI 엔트리포인트
│   ├── server.ts      # MCP 서버
│   ├── codex.ts       # Codex CLI 래퍼
│   └── types/
│       └── index.ts   # 타입 정의
├── dist/              # 빌드 결과
│   ├── index.js
│   ├── index.d.ts
│   └── index.js.map
├── docs/
│   ├── 개요.md        # 프로젝트 개요
│   ├── 구조.md        # 폴더 구조 (이 파일)
│   ├── 흐름.md        # 프로세스 플로우
│   └── 배포.md        # 설치 및 배포
├── package.json
├── tsconfig.json
├── biome.json         # Linter/Formatter
├── vite.config.ts     # 빌드 설정
├── .env.example
├── .gitignore
├── README.md
└── LICENSE
```

## 핵심 파일

### src/index.ts
MCP 서버의 엔트리포인트다. 환경 변수를 로드하고 서버를 시작한다.

### src/server.ts
MCP 서버의 핵심 로직이다. generate_code 도구를 등록하고 요청을 처리한다.

주요 기능:
- MCP 도구 등록 (generate_code)
- 입력 검증 (Zod 스키마)
- Codex CLI 호출
- 에러 처리 및 로깅

### src/codex.ts
Codex CLI를 호출하는 래퍼다. spawn + stdin 파이프 방식으로 안전하게 실행한다.

보안 개선:
- Command injection 방지 (stdin 파이프 사용)
- 출력 크기 제한 (1MB)
- 적절한 타임아웃 처리

에러 처리:
- Codex CLI 미설치 (ENOENT)
- 권한 없음 (EACCES)
- 타임아웃
- 인증 실패
- 출력 크기 초과
- stdin 쓰기 실패

### src/types/index.ts
TypeScript 타입 정의다.

타입:
- GenerateCodeParams: MCP 도구 입력
- CodexErrorCode: 에러 코드 enum
- CodexError: 구조화된 에러
- CodexResult: Codex CLI 결과
- ServerConfig: 서버 설정

## 설정 파일

### package.json
프로젝트 메타데이터와 의존성이다.

의존성:
- @modelcontextprotocol/sdk: MCP 프로토콜
- zod: 입력 검증
- dotenv: 환경 변수

### .env.example
환경 변수 템플릿이다.

설정:
- LOG_LEVEL: 로그 레벨 (debug, info, warn, error)
- CODEX_TIMEOUT: Codex CLI 타임아웃 (밀리초)

### ~/.claude.json
Claude Code MCP 서버 등록 파일이다. 이 프로젝트를 Claude Code에 연결할 때 사용한다.
